(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[977],{1215:function(e,t,s){Promise.resolve().then(s.bind(s,8923))},8923:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var r=s(7437),n=s(2265),a=s(9376),i=s(2141),l=s(7648);function o(){(0,a.useRouter)();let e=(0,a.useSearchParams)().get("id"),[t,s]=(0,n.useState)(""),[o,c]=(0,n.useState)(""),[d,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(null),[x,f]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e&&(async()=>{let{data:t}=await i.O.from("users").select("*").eq("link_id",e).single();t&&h(t)})()},[e]);let b=async e=>{if(e.preventDefault(),m&&!d){u(!0);try{let e=null;try{let s=await fetch("https://vlydnlmwwhofsksikaeh.supabase.co/functions/v1/analyze-emotion",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZseWRubG13d2hvZnNrc2lrYWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3ODQ0NzEsImV4cCI6MjA3ODM2MDQ3MX0.XA5pvZRRAVd5h3q1g4iJ0Muibadb1gIKbSBnuW9lu78")},body:JSON.stringify({message:t})});s.ok&&(e=await s.json())}catch(e){console.warn("AI Analysis failed, proceeding without it",e)}let{error:s}=await i.O.from("messages").insert({user_id:m.id,content:t,sender_name:o||"익명",is_opened:!1,emotion_analysis:e});if(s)throw s;f(!0)}catch(e){console.error("Message Send Error:",e),alert("선물 전송에 실패했어요 \uD83D\uDE22\n오류 내용: ".concat(e.message||JSON.stringify(e)))}finally{u(!1)}}};return m?x?(0,r.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-green-50 py-10 px-4 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-10 border-2 border-green-100 text-center",children:[(0,r.jsx)("div",{className:"text-6xl mb-6 animate-bounce",children:"\uD83C\uDF81"}),(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:"선물 배달 완료!"}),(0,r.jsxs)("p",{className:"text-gray-600 mb-8 text-lg",children:[m.username,"님에게 마음을",(0,r.jsx)("br",{}),"성공적으로 전달했어요."]}),(0,r.jsx)("button",{onClick:()=>window.location.href="/box?id=".concat(e),className:"w-full py-4 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition-colors shadow-lg hover:shadow-xl transform hover:-translate-y-1",children:"선물함으로 돌아가기 →"})]})}):(0,r.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-green-50 py-10 px-4",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto bg-white rounded-2xl shadow-xl p-8 border-2 border-red-100",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold text-gray-800",children:[m.username,"님에게 마음 선물하기 \uD83C\uDF81"]}),(0,r.jsxs)("p",{className:"text-gray-500 mt-2 text-sm",children:["따뜻한 겨울 인사를 남겨주세요.",(0,r.jsx)("br",{}),"친구에게 바로 배달됩니다."]})]}),(0,r.jsxs)("form",{onSubmit:b,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"보내는 사람 (선택)"}),(0,r.jsx)("input",{type:"text",value:o,onChange:e=>c(e.target.value),placeholder:"익명 (비워두면 익명으로 전달돼요)",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition-all",maxLength:20})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"메시지 내용"}),(0,r.jsx)("textarea",{value:t,onChange:e=>s(e.target.value),required:!0,placeholder:"여기에 소중한 마음을 담아주세요...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition-all h-40 resize-none",maxLength:500}),(0,r.jsxs)("div",{className:"text-right text-xs text-gray-400 mt-1",children:[t.length,"/500"]})]}),(0,r.jsx)("button",{type:"submit",disabled:d,className:"w-full py-3 bg-gradient-to-r from-red-500 to-green-500 text-white font-bold rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all disabled:opacity-50",children:d?"AI가 선물 포장 중... \uD83C\uDF81":"선물 보내기 \uD83C\uDF81"})]}),(0,r.jsx)("div",{className:"mt-6 text-center",children:(0,r.jsx)(l.default,{href:"/box?id=".concat(e),className:"text-sm text-gray-500 hover:text-gray-700",children:"취소하고 돌아가기"})})]})}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"로딩 중..."})}function c(){return(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"로딩 중..."}),children:(0,r.jsx)(o,{})})}},2141:function(e,t,s){"use strict";s.d(t,{O:function(){return i}});var r=s(338);let n="https://vlydnlmwwhofsksikaeh.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZseWRubG13d2hvZnNrc2lrYWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3ODQ0NzEsImV4cCI6MjA3ODM2MDQ3MX0.XA5pvZRRAVd5h3q1g4iJ0Muibadb1gIKbSBnuW9lu78";n&&a||console.warn("Supabase environment variables are not set");let i=(0,r.createBrowserClient)(n,a)},7648:function(e,t,s){"use strict";s.d(t,{default:function(){return n.a}});var r=s(2972),n=s.n(r)},9376:function(e,t,s){"use strict";var r=s(5475);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[338,972,971,117,744],function(){return e(e.s=1215)}),_N_E=e.O()}]);