(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[977],{108:function(e,t,s){Promise.resolve().then(s.bind(s,8923))},8923:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var n=s(7437),r=s(2265),a=s(9376),i=s(2141),l=s(7648);function o(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)().get("id"),[s,o]=(0,r.useState)(""),[c,u]=(0,r.useState)(""),[d,m]=(0,r.useState)(!1),[h,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&(async()=>{let{data:e}=await i.O.from("users").select("*").eq("link_id",t).single();e&&f(e)})()},[t]);let x=async n=>{if(n.preventDefault(),h&&!d){m(!0);try{let n=null;try{let e=await fetch("https://vlydnlmwwhofsksikaeh.supabase.co/functions/v1/analyze-emotion",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZseWRubG13d2hvZnNrc2lrYWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3ODQ0NzEsImV4cCI6MjA3ODM2MDQ3MX0.XA5pvZRRAVd5h3q1g4iJ0Muibadb1gIKbSBnuW9lu78")},body:JSON.stringify({message:s})});e.ok&&(n=await e.json())}catch(e){console.warn("AI Analysis failed, proceeding without it",e)}let{error:r}=await i.O.from("messages").insert({user_id:h.id,content:s,sender_name:c||"익명",is_opened:!1,emotion_analysis:n});if(r)throw r;alert("마음의 선물이 성공적으로 전달되었어요! \uD83C\uDF81"),e.push("/box?id=".concat(t))}catch(e){console.error("Message Send Error:",e),alert("선물 전송에 실패했어요 \uD83D\uDE22\n오류 내용: ".concat(e.message||JSON.stringify(e)))}finally{m(!1)}}};return h?(0,n.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-green-50 py-10 px-4",children:(0,n.jsxs)("div",{className:"max-w-md mx-auto bg-white rounded-2xl shadow-xl p-8 border-2 border-red-100",children:[(0,n.jsxs)("div",{className:"text-center mb-8",children:[(0,n.jsxs)("h1",{className:"text-2xl font-bold text-gray-800",children:[h.username,"님에게 마음 선물하기 \uD83C\uDF81"]}),(0,n.jsxs)("p",{className:"text-gray-500 mt-2 text-sm",children:["따뜻한 겨울 인사를 남겨주세요.",(0,n.jsx)("br",{}),"친구에게 바로 배달됩니다."]})]}),(0,n.jsxs)("form",{onSubmit:x,className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"보내는 사람 (선택)"}),(0,n.jsx)("input",{type:"text",value:c,onChange:e=>u(e.target.value),placeholder:"익명 (비워두면 익명으로 전달돼요)",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition-all",maxLength:20})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"메시지 내용"}),(0,n.jsx)("textarea",{value:s,onChange:e=>o(e.target.value),required:!0,placeholder:"여기에 소중한 마음을 담아주세요...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition-all h-40 resize-none",maxLength:500}),(0,n.jsxs)("div",{className:"text-right text-xs text-gray-400 mt-1",children:[s.length,"/500"]})]}),(0,n.jsx)("button",{type:"submit",disabled:d,className:"w-full py-3 bg-gradient-to-r from-red-500 to-green-500 text-white font-bold rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all disabled:opacity-50",children:d?"AI가 선물 포장 중... \uD83C\uDF81":"선물 보내기 \uD83C\uDF81"})]}),(0,n.jsx)("div",{className:"mt-6 text-center",children:(0,n.jsx)(l.default,{href:"/box?id=".concat(t),className:"text-sm text-gray-500 hover:text-gray-700",children:"취소하고 돌아가기"})})]})}):(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"로딩 중..."})}function c(){return(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"로딩 중..."}),children:(0,n.jsx)(o,{})})}},2141:function(e,t,s){"use strict";s.d(t,{O:function(){return i}});var n=s(338);let r="https://vlydnlmwwhofsksikaeh.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZseWRubG13d2hvZnNrc2lrYWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3ODQ0NzEsImV4cCI6MjA3ODM2MDQ3MX0.XA5pvZRRAVd5h3q1g4iJ0Muibadb1gIKbSBnuW9lu78";r&&a||console.warn("Supabase environment variables are not set");let i=(0,n.createBrowserClient)(r,a)},7648:function(e,t,s){"use strict";s.d(t,{default:function(){return r.a}});var n=s(2972),r=s.n(n)},9376:function(e,t,s){"use strict";var n=s(5475);s.o(n,"useRouter")&&s.d(t,{useRouter:function(){return n.useRouter}}),s.o(n,"useSearchParams")&&s.d(t,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[338,972,971,117,744],function(){return e(e.s=108)}),_N_E=e.O()}]);